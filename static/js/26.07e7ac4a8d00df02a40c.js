webpackJsonp([26],{WKqN:function(e,t){},iprf:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Xxa5"),s=a.n(i),n=a("exGp"),r=a.n(n),l=a("Dd8w"),c=a.n(l),o=a("c/Tr"),g=a.n(o),u=a("Gu7T"),p=a.n(u),d=a("lHA8"),m=a.n(d),v={name:"ImageManagerWithCategory",data:function(){return{imageList:[],filteredImages:[],pageSize:8,pageNum:1,search:"",selectedCategory:"全部",categories:["全部"],dialogVisible:!1,previewImageData:{},selectedFile:null}},computed:{pagedImages:function(){var e=(this.pageNum-1)*this.pageSize;return this.filteredImages.slice(e,e+this.pageSize)}},mounted:function(){this.fetchImages()},methods:{fetchImages:function(){var e=this;this.$http.get("/api/images/list").then(function(t){var a=t.data||[],i=new m.a(a.map(function(e){return e.category}));e.categories=["全部"].concat(p()(g()(i))),e.imageList=a.map(function(e){return c()({},e,{uploadTime:e.uploadTime||(new Date).toLocaleString()})}),e.filterImages()})},filterImages:function(){var e=this,t=this.imageList;this.search&&(t=t.filter(function(t){return t.name.includes(e.search)})),this.selectedCategory&&"全部"!==this.selectedCategory&&(t=t.filter(function(t){return t.category===e.selectedCategory})),this.filteredImages=t,this.pageNum=1},handlePageChange:function(e){this.pageNum=e},getImageUrl:function(e){return"http://localhost:8080"+e},previewImage:function(e){this.previewImageData=c()({},e,{url:this.getImageUrl(e.url)}),this.dialogVisible=!0},deleteImage:function(e){var t=this;this.$confirm("确定删除该图像？","提示",{type:"warning"}).then(function(){t.$http.delete("/api/images/"+e).then(function(){t.$message.success("删除成功"),t.fetchImages()})})},beforeUpload:function(e){return this.selectedFile=e,!1},handleFileChange:function(e){this.selectedFile=e.raw||e},submitUpload:function(){var e=this;return r()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.selectedFile){t.next=3;break}return e.$message.warning("请先选择图片文件"),t.abrupt("return");case 3:return t.prev=3,(a=new FormData).append("file",e.selectedFile),a.append("category","全部"===e.selectedCategory?"默认分类":e.selectedCategory),t.next=9,e.$http.post("/api/images/upload",a,{headers:{"Content-Type":"multipart/form-data"}});case 9:e.$message.success("上传成功"),e.selectedFile=null,e.fetchImages(),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),console.error(t.t0),e.$message.error("上传失败");case 18:case"end":return t.stop()}},t,e,[[3,14]])}))()}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"image-manager"},[a("div",{staticClass:"header-bar"},[a("h2",[e._v("分类钻孔图像管理")]),e._v(" "),a("div",{staticClass:"tools"},[a("el-select",{attrs:{placeholder:"选择分类",clearable:""},on:{change:e.filterImages},model:{value:e.selectedCategory,callback:function(t){e.selectedCategory=t},expression:"selectedCategory"}},e._l(e.categories,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),a("el-input",{attrs:{placeholder:"搜索图像名称",clearable:""},on:{input:e.filterImages},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-upload",{staticClass:"upload-btn",attrs:{"show-file-list":!1,"before-upload":e.beforeUpload,"on-change":e.handleFileChange,"auto-upload":!1}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-upload"}},[e._v("上传图片")])],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",disabled:!e.selectedFile},on:{click:e.submitUpload}},[e._v("\n        确认上传\n      ")])],1)]),e._v(" "),a("div",{staticClass:"image-gallery"},e._l(e.pagedImages,function(t){return a("div",{key:t.id,staticClass:"image-card"},[a("el-image",{staticClass:"image-thumb",attrs:{src:e.getImageUrl(t.url),fit:"cover"},on:{click:function(a){return e.previewImage(t)}}}),e._v(" "),a("div",{staticClass:"card-footer"},[a("div",{staticClass:"img-name"},[e._v(e._s(t.name))]),e._v(" "),a("div",{staticClass:"img-actions"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.previewImage(t)}}},[e._v("查看")]),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.deleteImage(t.id)}}})],1)])],1)}),0),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{layout:"prev, pager, next",total:e.filteredImages.length,"page-size":e.pageSize,"current-page":e.pageNum},on:{"current-change":e.handlePageChange}})],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible,width:"60%",top:"15vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"preview-container"},[a("img",{staticClass:"preview-img",attrs:{src:e.previewImageData.url}}),e._v(" "),a("div",{staticClass:"preview-info"},[a("p",[a("strong",[e._v("名称：")]),e._v(e._s(e.previewImageData.name))]),e._v(" "),a("p",[a("strong",[e._v("分类：")]),e._v(e._s(e.previewImageData.category))]),e._v(" "),a("p",[a("strong",[e._v("上传时间：")]),e._v(e._s(e.previewImageData.uploadTime))])])])])],1)},staticRenderFns:[]};var f=a("VU/8")(v,h,!1,function(e){a("WKqN")},"data-v-0963badf",null);t.default=f.exports}});
//# sourceMappingURL=26.07e7ac4a8d00df02a40c.js.map